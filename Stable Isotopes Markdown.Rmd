---
title: "Isotopes Analysis Package - Mammal Lab"
author: "Gary Truong and Ben Walker"
date: "07/07/2020"
output: html_document
---

```{r setup, include=FALSE}
#install.packages("devtools")
#install.packages("roxygen2")
#install.packages("usethis")


library(devtools)
library(roxygen2)
library(tidyverse)

# devtools::create("whiskR")
```

Add functions 
```{r}
x <- (92.6-(14*(0.0126*141.5)))/(1-(14*0.0126))

# LP1 calculates the cut section length that should be cut to obtain a defined time period. 
LP1 <- function(L, Time, k, L.asym){
  section = format((L - (Time*(k*L.asym)))/(1-(Time*k)), digits = 4, nsmall = 1)
  paste(section, "mm", sep = "")
}
# k is estimated from seal whiskers and adapted for devils, assumption that whiskers fall out after 1 year
# L.asym is asymptotic length which is longest recorded length + 1% at the given position
# L is length of cut or plucked whisker
# Time is specified numnber of days represented by sample
# This function does not factor in intradermal length 

LP1(156.2,75, 0.0126, 171.4)

LP1(129.5, 14, 0.0126, 150.3)
LP1(125.045, 14, 0.0126, 150.3)

#TP1 calculates the time period that is represented based on a cut section 
TP1 <- function(Lp, Lp1, k, L.asym){
  time = format((Lp - Lp1)/(k*(L.asym-Lp1)), digits = 3, nsmall = 0)
  paste(time, "days", sep = " ")
}

 ## Simple Von Bertanlanffy equation for L and T
## L = L.asym * (1-exp(-KT))
## T = (-log(1-156.2/171.4))/(0.0126)
  

# MaxTime uses simple Von Bertanlanffy model (growth function) to caclulate maximum theoretically time that the sample whisker represents
MaxTime <- function(L , L.asym, k){
  Time = format((-log(1-L/L.asym))/(k), digits = 4, nsmall = 1)
  paste(Time, "days", sep = " ")
}


MaxTime(169.7, 171.4, 0.0126)  

# K - growth coefficient

k <- function(L, L.asym, Time){
   k = format((-log(1-L/L.asym))/(Time), digits = 4)
   k
}


k(1000, 1010, 365)


#Intra time calculates the days represented by the intradermal length
Intra.time <- function(L.int, L.asym, L, k){
  time = format((L.int)/(k*(L.asym - (L - L.int))), digits = 3, nsmall = 0)
  paste(time, "days", sep = " ")
}

Intra.time(5.3, 163.4, 127.8, 0.0126)

## Vindi tassie devil
MaxTime(127.8, 163.4, 0.0126)

#Vindi sampled on 1st August 2018 , 120.9 max days, should go back to april 

Date

```


Generate documents for functions
```{r}
devtools::document()
```



```{r}
devtools::load_all()


devtools::install()
library(whiskR)

devtools::install_github("GaryTruong/whiskR")
library(whiskR)
?k
```

Create a vignette
```{r}
library(usethis)
#usethis::use_vignette("whiskR vignette")
```

Creating  Website
```{r}
# not working for R 4.0.2
#install.packages("rpkgdown")

devtools::install_github("r-lib/pkgdown")
library(rpkgdown)

# Run once to configure package to use pkgdown
usethis::use_pkgdown()
# Run to build the website
pkgdown::build_site()
```

```{r}
LP1(150,170,14,0.0126)
LP1(145.7,170,14,0.0126)
LP1(140.5,170,14,0.0126)
LP1(134.2,170,14,0.0126)
LP1(126.5,170,14,0.0126)
LP1(117.2,170,14,0.0126)
LP1(105.9,170,14,0.0126)
LP1(92.17,170,14,0.0126)
LP1(75.5,170,14,0.0126)
LP1(55.26,170,14,0.0126)
LP1(30.68,170,14.3,0.0126)

14*11
TP1(L=150 ,L.asym=170, LP1=140.5, k=0.0126)

14*12
MaxTime(150,170,0.0126)
library(dplyr)

sample <- function(L, L.asym, Time, k){
  a <- as.numeric(whiskR::LP1(L, L.asym, Time, k)) 
  b <- as.numeric(whiskR::LP1(L, L.asym, Time, k)) %>%
    whiskR::LP1(L.asym, Time, k)
  as.numeric(c(a,b,Time))
}
a <- c()
a <- c(1)
b <- c(a)
sample(150,170,14,0.0126)



section <- function(L, L.asym, k, Time = 1){
  out <- list(0)
  a <- as.numeric(whiskR::LP1(L, L.asym, Time, k)) 
  out[1] <- a
  out[2] <- Time
  out[3] <- L
  out[[3]][2] <- a
  for(i in 1:1000){
    if(a > 0 & a < L){
      a <- as.numeric(out[[1]][i]) %>% 
      whiskR::LP1(L.asym, Time, k)
      out[[1]][i+1] = a
      out[[2]][i+1] = Time
      out[[3]][i+2] = a
    }else{
    stop
    }
  }
  x <- tibble::enframe(as.numeric(out[[3]])) %>%
    dplyr::select(name, L.start = value)
  y <- tibble::enframe(as.numeric(out[[2]])) %>% 
    dplyr::select(name, time = value)
  z <- tibble::enframe(as.numeric(out[[1]])) %>%
    dplyr::select(name,L.end = value)
  x %>% left_join(z) %>% left_join(y)%>%
    dplyr::filter(L.end > 0) %>%
    dplyr::mutate(SectionLength = L.start-L.end, Date = date())
}


b <- section(150,170, 0.0126, 5)


MaxTime(150,170,0.0126)
```

14*11
